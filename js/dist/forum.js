(()=>{var t={n:r=>{var u=r&&r.__esModule?()=>r.default:()=>r;return t.d(u,{a:u}),u},d:(r,u)=>{for(var e in u)t.o(u,e)&&!t.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:u[e]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};(()=>{"use strict";const r=flarum.core.compat["common/app"];t.n(r)().initializers.add("huseyinfiliz/bump",function(){console.log("[huseyinfiliz/bump] Hello, forum and admin!")});const u=flarum.core.compat["forum/app"];var e=t.n(u);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/utils/DiscussionControls"];var a=t.n(o);const i=flarum.core.compat["common/components/Button"];var l=t.n(i);const s=flarum.core.compat["common/models/Discussion"];var p=t.n(s);const c=flarum.core.compat["common/helpers/humanTime"];var f=t.n(c);e().initializers.add("huseyinfiliz/bump",function(){(0,n.extend)(a(),"moderationControls",function(t,r){if(e().forum.attribute("huseyinfiliz-bump.enable-manual-bump")&&r.canBump()){var u=r.bumpCooldownHours()||0,n=r.canModerateBumps(),o=r.isBumpDisabled(),a=r.lastManualBumpedAt(),i=(r.dailyBumpQuota(),r.weeklyBumpQuota(),!0),s=e().translator.trans("huseyinfiliz-bump.forum.bump_button"),p=s,c="",d=0;if(o&&(i=!1,c=String(e().translator.trans("huseyinfiliz-bump.forum.bump_disabled_for_group")),s=e().translator.trans("huseyinfiliz-bump.forum.bump_disabled"),p=c),!n&&!o){if(u>0&&a){var b=(Date.now()-a.getTime())/36e5;if(b<u){i=!1,d=Math.ceil(60*(u-b));var y=new Date(a.getTime()+60*u*60*1e3);c=String(e().translator.trans("huseyinfiliz-bump.forum.bump_cooldown",{time:f()(y)}))}}var h=r.dailyBumpQuota(),B=r.weeklyBumpQuota();if(i&&h&&h.remaining<=0&&(i=!1,c=String(e().translator.trans("huseyinfiliz-bump.forum.bump_quota_exceeded_daily"))),i&&B&&B.remaining<=0&&(i=!1,c=String(e().translator.trans("huseyinfiliz-bump.forum.bump_quota_exceeded_weekly"))),d>0){var v=function(t){if(t<60)return t+"m";var r=Math.floor(t/60),u=t%60;return u>0?r+"h "+u+"m":r+"h"}(d);s=e().translator.trans("huseyinfiliz-bump.forum.bump_button_cooldown",{time:v}),p=c}else{var _=null,w=[];h&&h.limit>0&&(_=h,w.push("Daily: "+h.remaining+"/"+h.limit)),B&&B.limit>0&&(w.push("Weekly: "+B.remaining+"/"+B.limit),(!_||B.remaining<_.remaining)&&(_=B)),_?(s=e().translator.trans("huseyinfiliz-bump.forum.bump_button_quota",{count:_.remaining}),p=w.join(", ")):i||(p=c)}}t.add("bump",l().component({icon:"fas fa-level-up-alt",disabled:!i,title:p,onclick:i?function(){e().alerts.clear(),e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/manual-bump/"+r.id()}).then(function(){e().discussions.refresh(),m.redraw(),e().alerts.show({type:"success"},e().translator.trans("huseyinfiliz-bump.forum.bump_success"))},function(t){var r,u=(null==(r=t.response)||null==(r=r.errors)||null==(r=r[0])?void 0:r.detail)||e().translator.trans("huseyinfiliz-bump.forum.bump_error");e().alerts.show({type:"error"},u)})}:void 0},s),-1)}})}),p().prototype.canBump=function(){return this.attribute("canBump")},p().prototype.lastBumpedAt=function(){var t=this.attribute("lastBumpedAt");return t?new Date(t):null},p().prototype.lastManualBumpedAt=function(){var t=this.attribute("lastManualBumpedAt");return t?new Date(t):null},p().prototype.dailyBumpQuota=function(){return this.attribute("dailyBumpQuota")},p().prototype.weeklyBumpQuota=function(){return this.attribute("weeklyBumpQuota")},p().prototype.bumpCooldownHours=function(){return this.attribute("bumpCooldownHours")||0},p().prototype.canModerateBumps=function(){return this.attribute("canModerateBumps")||!1},p().prototype.isBumpDisabled=function(){return this.attribute("isBumpDisabled")||!1}})(),module.exports={}})();
//# sourceMappingURL=forum.js.map