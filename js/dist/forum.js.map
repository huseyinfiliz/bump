{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@huseyinfiliz/bump/webpack/bootstrap","webpack://@huseyinfiliz/bump/webpack/runtime/compat get default export","webpack://@huseyinfiliz/bump/webpack/runtime/define property getters","webpack://@huseyinfiliz/bump/webpack/runtime/hasOwnProperty shorthand","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['common/app']\"","webpack://@huseyinfiliz/bump/./src/common/index.ts","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['forum/app']\"","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['common/extend']\"","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['common/components/Button']\"","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['common/models/Discussion']\"","webpack://@huseyinfiliz/bump/external root \"flarum.core.compat['common/helpers/humanTime']\"","webpack://@huseyinfiliz/bump/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('huseyinfiliz/bump', () => {\n  console.log('[huseyinfiliz/bump] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Discussion'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/humanTime'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport Button from 'flarum/common/components/Button';\nimport Discussion from 'flarum/common/models/Discussion';\nimport humanTime from 'flarum/common/helpers/humanTime';\n\napp.initializers.add('huseyinfiliz/bump', () => {\n  extend(DiscussionControls, 'moderationControls', function (items, discussion: Discussion) {\n    // CHECK: Is manual bump enabled?\n    const manualBumpEnabled = app.forum.attribute('huseyinfiliz-bump.enable-manual-bump');\n\n    if (!manualBumpEnabled) {\n      return; // Feature disabled, don't show button\n    }\n\n    if (!discussion.canBump()) {\n      return; // No permission\n    }\n\n    // Get user-specific settings from backend (respects group overrides)\n    const cooldownHours = discussion.bumpCooldownHours() || 0;\n    const isModerator = discussion.canModerateBumps();\n    const isBumpDisabled = discussion.isBumpDisabled();\n    const lastManualBumpedAt = discussion.lastManualBumpedAt();\n    const dailyQuota = discussion.dailyBumpQuota();\n    const weeklyQuota = discussion.weeklyBumpQuota();\n\n    let canBumpNow = true;\n    let buttonText = app.translator.trans('huseyinfiliz-bump.forum.bump_button');\n    let tooltipText = buttonText;\n    let disableReason: string = '';\n    let cooldownMinutes = 0;\n\n    // CHECK: Is bump disabled for user's group?\n    if (isBumpDisabled) {\n      canBumpNow = false;\n      disableReason = String(app.translator.trans('huseyinfiliz-bump.forum.bump_disabled_for_group'));\n      buttonText = app.translator.trans('huseyinfiliz-bump.forum.bump_disabled');\n      tooltipText = disableReason;\n    }\n\n    if (!isModerator && !isBumpDisabled) {\n      // Cooldown check (only if cooldown > 0)\n      if (cooldownHours > 0 && lastManualBumpedAt) {\n        const hoursSince = (Date.now() - lastManualBumpedAt.getTime()) / (1000 * 60 * 60);\n\n        if (hoursSince < cooldownHours) {\n          canBumpNow = false;\n          cooldownMinutes = Math.ceil((cooldownHours - hoursSince) * 60);\n          const nextBumpTime = new Date(lastManualBumpedAt.getTime() + cooldownHours * 60 * 60 * 1000);\n          disableReason = String(\n            app.translator.trans('huseyinfiliz-bump.forum.bump_cooldown', {\n              time: humanTime(nextBumpTime),\n            })\n          );\n        }\n      }\n\n      // Quota check\n      const dailyQuota = discussion.dailyBumpQuota();\n      const weeklyQuota = discussion.weeklyBumpQuota();\n\n      if (canBumpNow && dailyQuota && dailyQuota.remaining <= 0) {\n        canBumpNow = false;\n        disableReason = String(app.translator.trans('huseyinfiliz-bump.forum.bump_quota_exceeded_daily'));\n      }\n\n      if (canBumpNow && weeklyQuota && weeklyQuota.remaining <= 0) {\n        canBumpNow = false;\n        disableReason = String(app.translator.trans('huseyinfiliz-bump.forum.bump_quota_exceeded_weekly'));\n      }\n\n      // Build button text and tooltip\n      if (cooldownMinutes > 0) {\n        // Priority 1: Show cooldown time\n        const timeText = formatCooldownTime(cooldownMinutes);\n        buttonText = app.translator.trans('huseyinfiliz-bump.forum.bump_button_cooldown', { time: timeText });\n        tooltipText = disableReason;\n      } else {\n        // Priority 2: Show most restrictive quota (daily or weekly)\n        let quotaToShow = null;\n        let quotaInfo: string[] = [];\n\n        // Collect quota info for tooltip\n        if (dailyQuota && dailyQuota.limit > 0) {\n          quotaToShow = dailyQuota;\n          quotaInfo.push(`Daily: ${dailyQuota.remaining}/${dailyQuota.limit}`);\n        }\n\n        if (weeklyQuota && weeklyQuota.limit > 0) {\n          quotaInfo.push(`Weekly: ${weeklyQuota.remaining}/${weeklyQuota.limit}`);\n\n          // If weekly is more restrictive, use it instead\n          if (!quotaToShow || weeklyQuota.remaining < quotaToShow.remaining) {\n            quotaToShow = weeklyQuota;\n          }\n        }\n\n        // Update button text with most restrictive quota\n        if (quotaToShow) {\n          buttonText = app.translator.trans('huseyinfiliz-bump.forum.bump_button_quota', { count: quotaToShow.remaining });\n          tooltipText = quotaInfo.join(', ');\n        } else if (!canBumpNow) {\n          // Disabled but no cooldown/quota shown\n          tooltipText = disableReason;\n        }\n      }\n    }\n\n    // Helper function to format cooldown time\n    function formatCooldownTime(minutes: number): string {\n      if (minutes < 60) {\n        return `${minutes}m`;\n      }\n      const hours = Math.floor(minutes / 60);\n      const mins = minutes % 60;\n      return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;\n    }\n\n    items.add(\n      'bump',\n      Button.component(\n        {\n          icon: 'fas fa-level-up-alt',\n          disabled: !canBumpNow,\n          title: tooltipText,\n          onclick: canBumpNow\n            ? () => {\n                app.alerts.clear();\n\n                app\n                  .request({\n                    method: 'POST',\n                    url: app.forum.attribute('apiUrl') + '/manual-bump/' + discussion.id(),\n                  })\n                  .then(\n                    () => {\n                      app.discussions.refresh();\n                      m.redraw();\n\n                      app.alerts.show({ type: 'success' }, app.translator.trans('huseyinfiliz-bump.forum.bump_success'));\n                    },\n                    (error) => {\n                      const message = error.response?.errors?.[0]?.detail || app.translator.trans('huseyinfiliz-bump.forum.bump_error');\n\n                      app.alerts.show({ type: 'error' }, message);\n                    }\n                  );\n              }\n            : undefined,\n        },\n        buttonText\n      ),\n      -1\n    );\n  });\n});\n\n// Extend Discussion model\ndeclare module 'flarum/common/models/Discussion' {\n  export default interface Discussion {\n    canBump(): boolean;\n    lastBumpedAt(): Date | null;\n    lastManualBumpedAt(): Date | null;\n    dailyBumpQuota(): { used: number; limit: number; remaining: number } | null;\n    weeklyBumpQuota(): { used: number; limit: number; remaining: number } | null;\n    bumpCooldownHours(): number;\n    canModerateBumps(): boolean;\n    isBumpDisabled(): boolean;\n  }\n}\n\nDiscussion.prototype.canBump = function () {\n  return this.attribute<boolean>('canBump');\n};\n\nDiscussion.prototype.lastBumpedAt = function () {\n  const timestamp = this.attribute<string>('lastBumpedAt');\n  return timestamp ? new Date(timestamp) : null;\n};\n\nDiscussion.prototype.lastManualBumpedAt = function () {\n  const timestamp = this.attribute<string>('lastManualBumpedAt');\n  return timestamp ? new Date(timestamp) : null;\n};\n\nDiscussion.prototype.dailyBumpQuota = function () {\n  return this.attribute<{ used: number; limit: number; remaining: number } | null>('dailyBumpQuota');\n};\n\nDiscussion.prototype.weeklyBumpQuota = function () {\n  return this.attribute<{ used: number; limit: number; remaining: number } | null>('weeklyBumpQuota');\n};\n\nDiscussion.prototype.bumpCooldownHours = function () {\n  return this.attribute<number>('bumpCooldownHours') || 0;\n};\n\nDiscussion.prototype.canModerateBumps = function () {\n  return this.attribute<boolean>('canModerateBumps') || false;\n};\n\nDiscussion.prototype.isBumpDisabled = function () {\n  return this.attribute<boolean>('isBumpDisabled') || false;\n};\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","console","log","extend","DiscussionControls","items","discussion","attribute","canBump","cooldownHours","bumpCooldownHours","isModerator","canModerateBumps","isBumpDisabled","lastManualBumpedAt","canBumpNow","dailyBumpQuota","weeklyBumpQuota","buttonText","trans","tooltipText","disableReason","cooldownMinutes","String","hoursSince","Date","now","getTime","Math","ceil","nextBumpTime","time","humanTime","dailyQuota","weeklyQuota","remaining","timeText","minutes","hours","floor","mins","formatCooldownTime","quotaToShow","quotaInfo","limit","push","count","join","Button","icon","disabled","title","onclick","clear","method","url","id","then","refresh","m","redraw","show","type","error","_error$response","message","response","errors","detail","undefined","Discussion","this","lastBumpedAt","timestamp"],"sourceRoot":""}